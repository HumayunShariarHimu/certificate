<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Certificate</title>
<style>
:root {
  --bg: #121212;
  --sidebar-bg: #1e1e1e;
  --preview-bg: #1a1a1a;
  --text-color: #e0e0e0;
  --folder-color: #f5a623;
  --file-color: #50e3c2;
  --hover-bg: #333;
  --active-bg: #444;
  --header-footer-bg: #1f1f1f;
}

* { box-sizing:border-box; margin:0; padding:0; }
body { font-family:'Segoe UI', sans-serif; background:var(--bg); color:var(--text-color); height:100vh; display:flex; flex-direction:column; }
header, footer { text-align:center; padding:15px; font-weight:bold; background:var(--header-footer-bg); }
header { font-size:2em; border-bottom:1px solid #333; }
footer { font-size:1em; border-top:1px solid #333; margin-top:auto; }

.container { flex:1; display:flex; overflow:hidden; transition:0.3s; }
.sidebar { width:300px; background:var(--sidebar-bg); padding:20px; overflow-y:auto; transition:0.3s; border-right:1px solid #333; }
.sidebar ul { list-style:none; padding-left:10px; }
.sidebar li { margin:5px 0; padding:5px 10px; cursor:pointer; border-radius:5px; transition:0.2s; }
.sidebar li:hover { background:var(--hover-bg); }
li.folder::before { content:"ðŸ“ "; color: var(--folder-color); margin-right:5px; }
li.file::before { content:"ðŸ“„ "; color: var(--file-color); margin-right:5px; }
li.folder > ul { display:none; margin-left:15px; }
li.folder.open > ul { display:block; }
li.active { background: var(--active-bg); }

.preview { flex:1; background: var(--preview-bg); padding:10px; display:flex; align-items:center; justify-content:center; position:relative; }
canvas { border-radius:8px; background:white; max-width:100%; height:auto; box-shadow:0 0 10px rgba(0,0,0,0.5); }

#toggleSidebar {
  display:none;
  position:absolute;
  top:10px;
  left:10px;
  background:var(--hover-bg);
  border:none;
  color:var(--text-color);
  font-size:1.2em;
  padding:5px 10px;
  border-radius:5px;
  cursor:pointer;
  z-index:10;
}

@media(max-width:900px){
  .container{ flex-direction: column; height:auto; }
  .sidebar{ width:100%; height:250px; padding:10px; transform:translateY(0); border-right:none; }
  .preview{ height:400px; padding:5px; }
  header{ font-size:1.5em; }
  #toggleSidebar{ display:block; }
}

@media(max-width:500px){
  .sidebar{ height:200px; padding:5px; }
  .preview{ height:300px; padding:5px; }
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
</script>
</head>
<body>
<header>Certificate</header>
<div class="container">
  <div class="sidebar" id="sidebar">
    <button id="toggleSidebar">â˜°</button>
    <ul id="fileTree"></ul>
  </div>
  <div class="preview">
    <canvas id="pdfViewer"></canvas>
  </div>
</div>
<footer>Humayun Shariar Himu</footer>

<script>
const user = "HumayunShariarHimu";
const repo = "certificate";
const apiBase = `https://api.github.com/repos/${user}/${repo}/contents`;

const fileTree = document.getElementById('fileTree');
const pdfCanvas = document.getElementById('pdfViewer');
const pdfContext = pdfCanvas.getContext('2d');
const sidebar = document.getElementById('sidebar');
const toggleBtn = document.getElementById('toggleSidebar');

toggleBtn.addEventListener('click', ()=>{
  sidebar.style.transform = sidebar.style.transform==='translateY(-250px)' ? 'translateY(0)' : 'translateY(-250px)';
});

// Fetch repository files recursively
async function fetchFiles(path="", parentUl=fileTree){
  const url = path ? `${apiBase}/${path}` : apiBase;
  try{
    const res = await fetch(url);
    if(!res.ok) return console.error("GitHub API error:", res.statusText);
    const data = await res.json();

    for(const item of data){
      const li = document.createElement('li');

      if(item.type==="dir"){
        li.textContent = item.name;
        li.classList.add("folder");
        const subUl = document.createElement('ul');
        li.appendChild(subUl);
        parentUl.appendChild(li);

        li.addEventListener("click", e=>{
          e.stopPropagation(); // stop bubbling
          li.classList.toggle("open");
        });

        await fetchFiles(item.path, subUl);

      } else if(item.type==="file" && item.name.endsWith(".pdf")){
        li.classList.add("file");
        li.textContent = item.name;

        li.addEventListener("click", e=>{
          e.stopPropagation(); // stop bubbling to folder
          document.querySelectorAll('.file').forEach(f=>f.classList.remove('active'));
          li.classList.add('active');

          const rawUrl = item.html_url.replace("github.com","raw.githubusercontent.com").replace("/blob/","/");
          renderPDF(rawUrl);

          if(window.innerWidth <= 900) sidebar.style.transform = 'translateY(-250px)';
        });

        parentUl.appendChild(li);
      }
    }
  }catch(err){
    console.error("Fetch error:", err);
  }
}

// PDF.js render
async function renderPDF(url){
  const loadingTask = pdfjsLib.getDocument(url);
  const pdf = await loadingTask.promise;
  const page = await pdf.getPage(1);

  const viewport = page.getViewport({scale:1.5});
  pdfCanvas.width = viewport.width;
  pdfCanvas.height = viewport.height;

  const renderContext = { canvasContext: pdfContext, viewport: viewport };
  await page.render(renderContext).promise;
}

// Initialize
window.addEventListener("DOMContentLoaded", ()=>fetchFiles());
</script>
</body>
</html>
